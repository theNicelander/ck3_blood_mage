# lifedrain event
# See dashboard on how the duel calculations are done
# https://share.streamlit.io/thenicelander/ck3_blood_mage_viz/main

namespace = bm_trait_drain

bm_trait_drain.001 = {
    type = character_event
    title = bm_trait_drain.001.title
    desc = bm_trait_drain.001.desc
    theme = witchcraft

    # Intellect drain -- Gain quick / intelligent / genius
    option = {
        name = bm_trait_drain.001.b
        trigger = { scope:recipient = { has_trait = intellect_good } }

        # Cost
        add_piety = trait_drain_intellect_cost
        temporary_trait_drain_attempted = yes

        # Carry out logic
        duel = {
            skill = learning
            target = scope:recipient
            10 = {
                desc = "I drain their intellect"

                # Difficulty
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 4
                }
                modifier = trait_drain_harder_per_trait_modifier
                
                # Success! Level up trait!
                intellect_drain_trait_effects = yes
            
                # Prisoner dies
                sacrifice_prisoner_effect = {
                    VICTIM = scope:recipient
                    EXECUTIONER = scope:actor
                }
            }
            30 = {
                desc = "I fail"
                drain_trait_failed_effects = yes
                modifier = { add = trait_drain_modifier_per_trait }
            }
        }
        ai_chance = { base = 100 }
    }

    # Strength drain -- Gain hale / robust / (amazonian or herculean)
    option = {
        name = bm_trait_drain.001.c
        trigger = { scope:recipient = { has_trait = physique_good } }

        # Cost
        add_piety = trait_drain_physique_cost
        temporary_trait_drain_attempted = yes

        # Carry out logic
        duel = {
            skill = learning
            target = scope:recipient
            10 = {
                desc = "I drain their strength"

                # Difficulty
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 4
                }
                modifier = trait_drain_harder_per_trait_modifier

                # Success! Level up trait!
                physique_drain_trait_effects = yes
                
                # Prisoner dies
                sacrifice_prisoner_effect = {
                    VICTIM = scope:recipient
                    EXECUTIONER = scope:actor
                }
            }
            30 = {
                desc = "I fail"
                temporary_negative_lifeforce_effect_major = yes

                modifier = { add = trait_drain_modifier_per_trait }
            }
        }
        ai_chance = { base = 100 }
    }

    # Beauty drain -- Gain comely / (pretty or handsome) / beautiful
    option = {
        name = bm_trait_drain.001.d
        trigger = { scope:recipient = { has_trait = beauty_good } }

        # Cost
        add_piety = trait_drain_beauty_cost
        temporary_trait_drain_attempted = yes

        # Carry out logic
        duel = {
            skill = learning
            target = scope:recipient
            10 = {
                desc = "I drain their beauty"
                
                # Difficulty
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 4
                }
                modifier = trait_drain_harder_per_trait_modifier

                # Success! Level up trait!
                beauty_drain_trait_effects = yes
                
                # Prisoner dies
                sacrifice_prisoner_effect = {
                    VICTIM = scope:recipient
                    EXECUTIONER = scope:actor
                }
            }
            30 = {
                desc = "I fail"
                temporary_negative_lifeforce_effect_major = yes

                modifier = { add = trait_drain_modifier_per_trait }
            }
        }
        ai_chance = { base = 100 }
    }

    # Fecund drain
    option = {
        name = bm_trait_drain.001.e
        trigger = { scope:recipient = { has_trait = fecund } }

        # Cost
        add_piety = trait_drain_base_piety_cost
        temporary_trait_drain_attempted = yes


        # Carry out logic
        duel = {
            skill = learning
            value = 0
            10 = {
                desc = "Nice"

                # Difficulty
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 4
                }
                modifier = trait_drain_harder_per_trait_modifier

                # Success!
                add_trait = fecund
                hematurgy_magic_cast_effect_major = yes

                # Prisoner dies
                sacrifice_prisoner_effect = {
                    VICTIM = scope:recipient
                    EXECUTIONER = scope:actor
                }
            }
            30 = {
                desc = "I fail"
                temporary_negative_lifeforce_effect_major = yes

                modifier = { add = trait_drain_modifier_per_trait }
            }
        }

        ai_chance = { base = 100 }
    }

    # Giant drain
    option = {
        name = bm_trait_drain.001.f
        trigger = { scope:recipient = { has_trait = giant } }

        # Cost
        add_piety = trait_drain_base_piety_cost
        temporary_trait_drain_attempted = yes


        # Carry out logic
        duel = {
            skill = learning
            value = 0
            10 = {
                desc = "I become a Giant"
                 # Difficulty
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 4
                }
                modifier = trait_drain_harder_per_trait_modifier

                # Success!
                add_trait = giant
                hematurgy_magic_cast_effect_major = yes
                
                # Prisoner dies
                sacrifice_prisoner_effect = {
                    VICTIM = scope:recipient
                    EXECUTIONER = scope:actor
                }
            }
            30 = {
                desc = "I fail"
                temporary_negative_lifeforce_effect_major = yes

                modifier = { add = trait_drain_modifier_per_trait }
            }
        }

        ai_chance = { base = 100 }
    }

    # Pure Blood drain
    option = {
        name = bm_trait_drain.001.g
        trigger = { scope:recipient = { has_trait = pure_blooded } }

        # Cost
        add_piety = trait_drain_base_piety_cost
        temporary_trait_drain_attempted = yes


        # Carry out logic
        duel = {
            skill = learning
            value = 0
            10 = {
                desc = "I become a pure blooded"

                # Difficulty
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 4
                }
                modifier = trait_drain_harder_per_trait_modifier

                # Success!
                add_trait = pure_blooded
                hematurgy_magic_cast_effect_major = yes

                # Prisoner dies
                sacrifice_prisoner_effect = {
                    VICTIM = scope:recipient
                    EXECUTIONER = scope:actor
                }
            }
            30 = {
                desc = "I fail"
                temporary_negative_lifeforce_effect_major = yes
                modifier = { add = trait_drain_modifier_per_trait }
            }
        }

        ai_chance = { base = 100 }
    }

    # Do nothing
    option = {
        name = bm_trait_drain.001.z
        ai_chance = { base = 5 }
        add_character_modifier = lifeforce_modifier_major
    }

    # Portraits
    left_portrait ={
        character = root
        animation = rage
    }
    right_portrait ={
        character = scope:recipient
        animation = beg
    }
}
