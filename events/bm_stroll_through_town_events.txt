# lifedrain event

namespace = bm_stroll_town

bm_stroll_town.001 = {
    type = character_event
    title = "The Bustling Streets"
    desc = "The town market teems with life as merchants hawk their wares and citizens haggle over prices. Colorful stalls line the cobblestone streets, offering everything from exotic spices to finely crafted jewelry. The scent of fresh bread mingles with the aroma of roasting meats as I consider which direction to explore."
    theme = default

    option = {
        name = "Venture to the darker corners where the destitute gather"
        trigger_event = { id = bm_stroll_town.002 }
    }

    # Do nothing
    option = {
        name = "Savor the simple pleasures of town life before returning to the burdens of rulership"
        add_stress = -10
        ai_chance = {
            base = 5
        }
    }

    # Portraits
    left_portrait = {
        character = root
        animation = idle
    }
}

bm_stroll_town.002 = {
    type = character_event
    title = "A Desperate Soul"
    desc = "Away from the cheerful bustle of the market, the town's true face reveals itself. In a forgotten corner of the square, a wretched figure hunches against a weathered wall. Dressed in tattered rags caked with filth, the beggar's hand trembles as it extends toward passersby, who quicken their pace to avoid the unfortunate soul. Despite the beggar's pitiable state, I sense something valuable that others cannot see—life essence ripe for the taking... or perhaps a chance to demonstrate mercy through my arcane gifts."
    theme = default

    # Create the beggar
    immediate = {
        hidden_effect = {
            create_character = {
                name = "Beggar McBeggarface"
                location = root.capital_province
                gender_female_chance = 50
                save_scope_as = beggar
                culture = root.culture
                trait = wounded_1   # minor
                trait = typhus      # medium
                trait = blind       # severe
                trait = cancer      # critical
                trait = drunkard    # flavour
            }
        }
    }

    # Lifedrain
    option = {
        name = "Their lifeforce will serve a greater purpose in my hands"

        duel = {
            skill = intrigue
            value = 0

            0 = {
                custom_tooltip = "My actions go unnoticed in the shadows of the square"
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 2
                }
                trigger_event = { id = bm_stroll_town.003 }
            }

            20 = {
                custom_tooltip = "A gasp from nearby—someone witnessed my dark harvest"

                trigger_event = { id = bm_stroll_town.004 }
            }
        }

        scope:beggar = { death = { death_reason = death_sacrificed_to_gods } }

        ai_chance = { base = 10 }
    }

    # heal them
    option = {
        name = "With a subtle gesture, I channel power to mend their bleeding wounds"
        trigger = {
            has_trait = lifestyle_blood_mage_group
        }
        scope:beggar = { remove_trait = wounded_1 }
        blood_magic_used = yes
        add_piety = cure_illness_cost_small_neg
        root.capital_county = {
            add_county_modifier = {
                modifier = healed_beggar_holding_1
                years = 3
            }
        }

        ai_chance = { base = 4 }
    }
    option = {
        name = "The fever that ravages their body is no match for my blood magic"
        trigger = {
            has_trait = lifestyle_blood_mage_group
        }
        scope:beggar = { remove_trait = typhus }
        add_piety = cure_illness_cost_medium_neg
        blood_magic_used_set_exp = { EXP = 2 }

        root.capital_county = {
            add_county_modifier = {
                modifier = healed_beggar_holding_2
                years = 5
            }
        }
        ai_chance = { base = 3 }
    }
    option = {
        name = "I place my hands upon their sightless eyes, commanding darkness to retreat"
        trigger = {
            OR = {
                has_trait = lifestyle_blood_mage_1
                has_trait = lifestyle_blood_mage_2
            }
            
        }
        scope:beggar = { remove_trait = blind }
        blood_magic_used_set_exp = { EXP = 3 }
        add_piety = cure_illness_cost_large_neg
        root.capital_county = {
            add_county_modifier = {
                modifier = healed_beggar_holding_3
                years = 7
            }
        }
        ai_chance = { base = 2 }
    }
    option = {
        name = "Even death's corruption shall yield to my command—I will purge the cancer from their flesh"
        trigger = {
            has_trait = lifestyle_blood_mage_2
        }
        scope:beggar = { remove_trait = cancer }
        blood_magic_used_set_exp = { EXP = 5 }
        add_piety = cure_illness_cost_xlarge_neg
        root.capital_county = {
            add_county_modifier = {
                modifier = healed_beggar_holding_4
                years = 10
            }
        }
        ai_chance = { base = 1 }
    }

    # Do nothing
    option = {
        name = "This wretch is not worth my attention—I shall return to more pleasant diversions"
        add_stress = -10
        ai_chance = {
            base = 5
        }
    }

    # Portraits
    left_portrait = {
        character = root
        animation = idle
    }
    right_portrait = {
        character = scope:beggar
        animation = beg
    }
}


bm_stroll_town.003 = {
    type = character_event
title = "Silent Harvest"
desc = "The beggar's desperate gasp is muffled by my hand as I draw the life essence from their frail body. A soft crimson mist flows from their lips, coiling around my fingers and seeping into my skin. The pitiful wretch slumps against the wall, their hollow eyes staring at nothing, just another unfortunate soul lost to the harshness of street life. I straighten my clothes and step back into the bustle of the market, the newfound power tingling beneath my skin. No one has witnessed my dark work—the shadows kept our secret well."
    theme = default

    option = { 
        name = "No one noticed"
        custom_tooltip = "No one noticed me, their lifeforce is mine"
        add_character_modifier = { modifier = lifeforce_modifier } 
    }

    # Portraits
    left_portrait = {
        character = root
        animation = idle
    }
}

bm_stroll_town.004 = {
    type = character_event
title = "Witnessed"
desc = "The beggar's life essence flows into me, their body shriveling as I absorb their vitality. Lost in the intoxicating surge of power, I fail to notice the approaching footsteps until it's too late. A woman's horrified gasp cuts through my concentration—a merchant's wife, basket clutched to her chest, eyes wide with terror as she witnesses the final moments of my dark ritual. She backs away, her scream gathering in her throat. By tomorrow, whispers will spread through the town of the noble who preys upon the destitute. The power I've gained comes with unwanted attention, but such is the price of carelessness."
    theme = default

    option = { 
        name = "Someone walked by and discovered me, after the deed was done."
        custom_tooltip = "Someone walked by and discovered me, the population won't be happy"
        add_character_modifier = { modifier = lifeforce_modifier }
        add_stress = 10
        add_dread = 5
        root.capital_county = {
            add_county_modifier = {
                modifier = drained_beggar_holding
                years = 5
            }
        } 
    }

    # Portraits
    left_portrait = {
        character = root
        animation = idle
    }
}

bm_stroll_town.005 = {
    type = character_event
    title = "They got away"
    desc = ""
    theme = default

    option = { 
        name = "They got away."
        custom_tooltip = "They got away, i'm left empty handed"
        add_stress = 5
    }

    # Portraits
    left_portrait = {
        character = root
        animation = idle
    }
}