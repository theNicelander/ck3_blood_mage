bm_cast_blood_magic_self_minor = {
    category = interaction_category_friendly
    auto_accept = yes
    common_interaction = yes
    interface_priority = 999
    send_name = bm_cast_blood_magic_self_minor
    desc = bm_cast_blood_magic_self_minor_desc

    is_shown = {
        scope:actor = { has_trait = lifestyle_blood_mage }
        scope:actor = scope:recipient 
    }
    is_valid_showing_failures_only = { 
        scope:actor = { has_character_modifier = lifeforce_modifier_minor }
    }
    send_options_exclusive = yes


    send_option = { # Channel minor lifeforce
        localization = bm_cast_blood_magic_self_minor.channel_minor
        flag = channel_minor
        is_valid = {
            scope:actor = {piety >= 75}
        }
    }
    send_option = { # Attune lifeforce
        localization = bm_cast_blood_magic_self_minor.attune_lifeforce
        flag = attune_lifeforce
        is_valid = {
            scope:actor = {piety >= 25}
        }
    }
    on_accept = {
        scope:actor = {
            if = { # Channel minor lifeforce
                limit = {scope:channel_minor = yes}
                trigger_event = { id = bm_channel_lifeforce_enlightenment_minor.001 }
                remove_character_modifier = lifeforce_modifier_minor
                add_xp_enlightenment = yes
                add_piety = -75
                custom_tooltip = channel_lifeforce_enlightenment_minor.effects_list
            }
            if = { # Attune lifeforce
                limit = {scope:attune_lifeforce = yes}
                trigger_event = { id = bm_attune_lifeforce.001 } 
                remove_character_modifier = lifeforce_modifier_minor
                add_piety = -25
                custom_tooltip = bm_attune_lifeforce.effects_list
            }
        }
    }
    ai_potential = { always = yes }
    ai_frequency = 1
    ai_will_do = {base = 100}
    # ai_will_do = {
    #     base = 1
	# 	modifier = { # if AI doesn't have any attunement, they should always do that first
	# 		add = 100
	# 		scope:attune_lifeforce = yes
    #         scope:actor = {
    #             NOT = {
    #                has_character_modifier = ancient_attuned
    #                has_character_modifier = enlightenment_attuned
    #                has_character_modifier = bloodline_attuned
    #                has_character_modifier = benediction_attuned
    #                has_character_modifier = hematurgy_attuned 
    #             }
    #         }
	# 	}
	# 	modifier = {
	# 		add = 1
	# 		scope:attune_lifeforce = yes
	# 	}
	# 	modifier = {
	# 		add = 5
	# 		scope:channel_minor = yes
    #         add = 10
    #     }
    #     modifier = { # only do if healthy
    #        scope:actor = {health <= fine_health} 
    #         add = -100
    #     }
    # }
}


bm_cast_blood_magic_self_major = {
    category = interaction_category_friendly
    auto_accept = yes
    common_interaction = yes
    interface_priority = 999

    send_name = bm_cast_blood_magic_self_major
    desc = bm_cast_blood_magic_self_major_desc

    is_shown = {
        scope:actor = { has_trait = lifestyle_blood_mage }
        scope:actor = scope:recipient 
    }
    is_valid_showing_failures_only = { 
        scope:actor = { has_character_modifier = lifeforce_modifier_major }
    }
    send_options_exclusive = yes


    send_option = { # Improve education
        localization = bm_cast_blood_magic_self_major.education_improve
        flag = improve_education
        is_valid = {
            scope:actor = {
                piety >= scaled_education_enhancement_cost
                piety_level >= 3
            }
        }
        is_shown = {
            scope:actor = {
                OR = { # Has a non level 5 education trait
                    AND = {
                        has_trait = education_diplomacy
                        NOT = {has_trait = education_diplomacy_5}
                    }
                    AND = {
                        has_trait = education_martial
                        NOT = {has_trait = education_martial_5}
                    }
                    AND = {
                        has_trait = education_learning
                        NOT = {has_trait = education_learning_5}
                    }
                    AND = {
                        has_trait = education_stewardship
                        NOT = {has_trait = education_stewardship_5}
                    }
                    AND = {
                        has_trait = education_intrigue
                        NOT = {has_trait = education_intrigue_5}
                    }
                }
            }
        }
    }

    on_accept = {
        scope:actor = {
            if = { # Improve education
                limit = {scope:improve_education = yes}
                trigger_event = { id = bm_education_enhancement.001 }
                add_piety = scaled_education_enhancement_cost_neg
                blood_magic_used_major = yes
                add_xp_bm_dynamic = {
                    TRACK = enlightenment
                    XP = 5
                }
                custom_tooltip = bm_cast_blood_magic_self_major.education_improve.desc
            }
        }
    }

    ai_potential = { always = yes }
    ai_frequency = 3
    ai_will_do = {
        base = 1
        ai_modifier_based_on_health = yes
    }
}
